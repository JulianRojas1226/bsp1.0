
html(lang="en")
    head
        meta(charset="UTF-8")
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        title Ventas
        link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous")
        link(rel="stylesheet", href="/css/ventas.css")
        link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer")
    body 
        header
            nav
                button#abrirModal-ventas ventas realizadas

        main 
            if mesas && mesas.length
                each mesa in mesas 
                    button(type="button" class="btn-mesa" data-id=`${mesa.ID}`) Mesa #{mesa.ID}
                    div(id=`modal-${mesa.ID}` class="modal")
                        div(class="modal-contenido")
                            span.cerrar &times; <!-- Botón para cerrar -->
                            h2 Mesa #{mesa.ID}
                            form(action=`/ingorden/${mesa.ID}`, method="post") 
                                select(name="producto") 
                                    if productos && productos.length 
                                        each producto in productos 
                                            option(value=producto.id)  #{producto.nombre}
                                    else 
                                        option(value="") no hay productos en stock 
                                label(for="#") cantidad
                                input(type="number", name="cantidad")
                                button(type="submit") agregar
                            div 
                                h1 Productos consumidos
                                table(border="1") 
                                    thead
                                        tr
                                        th fecha hora
                                        th Producto
                                        th Cantidad
                                        th Precio_u
                                        th total
                                        th editar
                                    if ordenes && ordenes.length 
                                        each orden in ordenes
                                            if mesa.ID === orden.mesa_id
                                                tbody
                                                    tr
                                                    td #{new Date(orden.HORA).toLocaleDateString("es-ES", {year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hopur12:true})}
                                                    td #{orden.producto}
                                                    td #{orden.cantidad}
                                                    td #{orden.precio_u}
                                                    td #{orden.total_p}
                                                    td 
                                                        form(action=`/eliminar/${orden.id}`, method="post")
                                                            button(type="submit" class="btn btn-danger") 
                                                                i.fa-regular.fa-trash-can
                                                        form(action=`/duplicar/${orden.id}`, method="post")
                                                            button(type="submit" class="btn btn btn-success") 
                                                                i.fa-solid.fa-repeat

                                    else    
                                        p no se han consumido productos
                            div 
                                if totales && totales.length
                                    each total in totales
                                        if mesa.ID  === total.mesa_id
                                            div
                                                h3 Total: $#{total.total_mesa}
                                                button(type="button" class="btn-pagar" data-id=`${mesa.ID}`) Pagar
                                                div(id=`modal-pagar-${mesa.ID}` class="modal")
                                                    div(class="modal-contenido")
                                                        span.cerrar &times; <!-- Close button -->
                                                        h2 Pago de la Mesa #{mesa.ID}
                                                        table 
                                                            thead
                                                                tr
                                                                th fecha hora
                                                                th Producto
                                                                th Cantidad
                                                                th Precio_u
                                                                th total
                                                            if ordenes && ordenes.length 
                                                                each orden in ordenes
                                                                    if mesa.ID === orden.mesa_id
                                                                        tbody 
                                                                            tr
                                                                            td #{new Date(orden.HORA).toLocaleDateString("es-ES", {year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hopur12:true})}
                                                                            td #{orden.producto}
                                                                            td #{orden.cantidad}
                                                                            td #{orden.precio_u}
                                                                            td #{orden.total_p}
                                                        
                                                        form(action=`/pagar/${mesa.ID}`, method="post")                                                        
                                                            select(name="pago")
                                                                if tipo_pagos && tipo_pagos.length 
                                                                    each tipo_pago in tipo_pagos                                    
                                                                        option(value=tipo_pago.id) #{tipo_pago.nombre} 
                                                                else 
                                                                        option(value="") no hay opciones
                                                            button(type="submit") pagar   
                                                    
                                else
            div#modal-ventas-res.modal-ventas-res
                div.modal-contenido-VENTAS
                    span#cerrarModal.cerrar ×
                    if pagos && pagos.length 
                        each pago in pagos 
                            details 
                                summary  mesa: #{pago.mesa} fecha: #{new Date(pago.fecha_fin).toLocaleDateString("es-ES",{ year:"numeric",month:"long", day:"numeric"})} metodo pago: #{pago.metodo_pago} total:  #{pago.total}
                                table 
                                    thead 
                                        tr 
                                            th hora 
                                            th producto 
                                            th cantidad 
                                            th precio unitario 
                                            th total 
                                    if ventasu && ventasu.length 
                                        each ventau in ventasu 
                                            if pago.fecha_inicio <= ventau.hora && pago.fecha_fin >= ventau.hora && pago.mesa === ventau.mesa 
                                                tbody  
                                                    tr 
                                                        td #{new Date(ventau.hora).toLocaleDateString("es-ES", {year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",hopur12:true})}
                                                        td #{ventau.producto}
                                                        td #{ventau.cantidad} 
                                                        td #{ventau.precio_u}
                                                        td #{ventau.total_p}
        footer
                    ul.nav.justify-content-center
                        li.nav-item
                            a.nav-link(href="/sesion") Ventas
                        li.nav-item
                            a.nav-link(href="/sesion") home
                        li.nav-item
                            a.nav-link(href="/prod") Productos
                        li.nav-item
                            a.nav-link(href="/res") Reservas
                        li.nav-item 
        script(src="/js/ventas.js")



                    







