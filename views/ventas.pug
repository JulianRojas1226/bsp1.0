
html(lang="en")
    head
        meta(charset="UTF-8")
        meta(name="viewport", content="width=device-width, initial-scale=1.0")
        title Ventas
        link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous")
        link(rel="stylesheet", href="/css/ventas.css")
        link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer")
    body
        nav.sidebar.close
            header
                .image-text
                    span.image
                        img(src="/img/BASSPROD3.png", alt="logo")
                .text.header-text
                    span.name CodingLab
                    span.profecion Web devoloper
                i.fa-solid.fa-greater-than.toggle
            .menu-bar
                .menu
                    ul.menu-links
                        li.nav-link
                            a(href="/sesion")
                                i.fa-solid.fa-house
                                span.text.nav-text Inicio
                        li.nav-link
                            a(href="/prod")
                                i.fa-solid.fa-beer-mug-empty
                                span.text.nav-text Productos
                        li.nav-link
                            a(href="/ventas")
                                i.fa-solid.fa-cart-shopping
                                span.text.nav-text Ventas
                        li.nav-link
                            a(href="/res")
                                i.fa-solid.fa-calendar
                                span.text.nav-text Reservas

                .bottom-content
                    li
                        a(href="/logout")
                            i.fa-solid.fa-right-from-bracket
                            span.text.nav-text Logout
                    li.mode
                        .moon-sun
                            i.fa-regular.fa-moon.icon.moon
                            i.fa-solid.fa-sun.icon.sun
                        span.mode-text.text Dark Mode
                        .toggle-switch
                            span.switch
        .home
            header
                nav
                    button#abrirModal-ventas ventas realizadas

            main 
                if mesas && mesas.length
                    each mesa in mesas 
                        button(type="button" class="btn-mesa" data-id=`${mesa.ID}`) Mesa #{mesa.ID}
                        div(id=`modal-${mesa.ID}` class="modal")
                            div(class="modal-contenido")
                                span.cerrar &times; <!-- Botón para cerrar -->
                                h2 Mesa #{mesa.ID}
                                form(action=`/ingorden/${mesa.ID}`, method="post") 
                                    select(name="producto") 
                                        if productos && productos.length 
                                            each producto in productos 
                                                option(value=producto.id)  #{producto.nombre}
                                        else 
                                            option(value="") no hay productos en stock 
                                    label(for="#") cantidad
                                    input(type="number", name="cantidad")
                                    button(type="submit") agregar
                                div 
                                    h1 Productos consumidos
                                    table(border="1") 
                                        thead
                                            tr
                                            th fecha hora
                                            th Producto
                                            th Cantidad
                                            th Precio_u
                                            th total
                                            th editar
                                        if ordenes && ordenes.length 
                                            each orden in ordenes
                                                if mesa.ID === orden.mesa_id
                                                    tbody
                                                        tr
                                                        td #{new Date(orden.HORA).toLocaleDateString("es-ES", {year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hopur12:true})}
                                                        td #{orden.producto}
                                                        td #{orden.cantidad}
                                                        td #{orden.precio_u}
                                                        td #{orden.total_p}
                                                        td 
                                                            form(action=`/eliminar/${orden.id}`, method="post")
                                                                button(type="submit" class="btn btn-danger") 
                                                                    i.fa-regular.fa-trash-can
                                                            form(action=`/duplicar/${orden.id}`, method="post")
                                                                button(type="submit" class="btn btn btn-success") 
                                                                    i.fa-solid.fa-repeat

                                        else    
                                            p no se han consumido productos
                                div 
                                    if totales && totales.length
                                        each total in totales
                                            if mesa.ID  === total.mesa_id
                                                div
                                                    h3 Total: $#{total.total_mesa}
                                                    button(type="button" class="btn-pagar" data-id=`${mesa.ID}`) Pagar
                                                    div(id=`modal-pagar-${mesa.ID}` class="modal")
                                                        div(class="modal-contenido")
                                                            span.cerrar &times; <!-- Close button -->
                                                            h2 Pago de la Mesa #{mesa.ID}
                                                            table 
                                                                thead
                                                                    tr
                                                                    th fecha hora
                                                                    th Producto
                                                                    th Cantidad
                                                                    th Precio_u
                                                                    th total
                                                                if ordenes && ordenes.length 
                                                                    each orden in ordenes
                                                                        if mesa.ID === orden.mesa_id
                                                                            tbody 
                                                                                tr
                                                                                td #{new Date(orden.HORA).toLocaleDateString("es-ES", {year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hopur12:true})}
                                                                                td #{orden.producto}
                                                                                td #{orden.cantidad}
                                                                                td #{orden.precio_u}
                                                                                td #{orden.total_p}
                                                            
                                                            form(action=`/pagar/${mesa.ID}`, method="post")                                                        
                                                                select(name="pago")
                                                                    if tipo_pagos && tipo_pagos.length 
                                                                        each tipo_pago in tipo_pagos                                    
                                                                            option(value=tipo_pago.id) #{tipo_pago.nombre} 
                                                                    else 
                                                                            option(value="") no hay opciones
                                                                button(type="submit") pagar   
                                                        
                                    else
                div#modal-ventas-res.modal-ventas-res
                    div.modal-contenido-VENTAS
                        span#cerrarModal.cerrar ×
                        if pagos && pagos.length 
                            each pago in pagos 
                                details 
                                    summary  mesa: #{pago.mesa} fecha: #{new Date(pago.fecha_fin).toLocaleDateString("es-ES",{ year:"numeric",month:"long", day:"numeric"})} metodo pago: #{pago.metodo_pago} total:  #{pago.total}
                                    table 
                                        thead 
                                            tr 
                                                th hora 
                                                th producto 
                                                th cantidad 
                                                th precio unitario 
                                                th total 
                                        if ventasu && ventasu.length 
                                            each ventau in ventasu 
                                                if pago.fecha_inicio <= ventau.hora && pago.fecha_fin >= ventau.hora && pago.mesa === ventau.mesa 
                                                    tbody  
                                                        tr 
                                                            td #{new Date(ventau.hora).toLocaleDateString("es-ES", {year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",hopur12:true})}
                                                            td #{ventau.producto}
                                                            td #{ventau.cantidad} 
                                                            td #{ventau.precio_u}
                                                            td #{ventau.total_p}
                        form#filtroForm(action="/ventas/pdf" method="GET")
                            label(for="inicio") Fecha Inicio:
                            input(type="date" name="inicio")

                            label(for="fin") Fecha Fin:
                            input(type="date" name="fin")

                            label(for="mes") Mes:
                            select(name="mes")
                                option(value="") Todos
                                option(value="1") Enero
                                option(value="2") Febrero
                                option(value="3") Marzo
                                option(value="4") Abril
                                option(value="5") Mayo
                                option(value="6") Junio
                                option(value="7") Julio
                                option(value="8") Agosto
                                option(value="9") Septiembre
                                option(value="10") Octubre
                                option(value="11") Noviembre
                                option(value="12") Diciembre

                            label(for="dia") Día de la Semana:
                            select(name="dia")
                                option(value="") Todos
                                option(value="1") Domingo
                                option(value="2") Lunes
                                option(value="3") Martes
                                option(value="4") Miércoles
                                option(value="5") Jueves
                                option(value="6") Viernes
                                option(value="7") Sábado

                            label(for="pago") Tipo de Pago:
                            select(name="pago")
                                if tipo_pagos && tipo_pagos.length 
                                    each tipo_pago in tipo_pagos                                    
                                        option(value=tipo_pago.id) #{tipo_pago.nombre} 
                                else 
                                        option(value="") no hay opciones
                            button(type="submit") Generar PDF
        script(src="/js/ventas.js")



                    







